package com.lwb.music.provider;import android.content.ContentProvider;import android.content.ContentUris;import android.content.ContentValues;import android.content.Context;import android.content.UriMatcher;import android.database.Cursor;import android.database.sqlite.SQLiteDatabase;import android.net.Uri;import android.provider.MediaStore;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.text.TextUtils;public class MusicProvider extends ContentProvider {    public static final String AUTOHORITY = "com.lwb.music";    private static final UriMatcher matcher;    private Context context;    private MusicHelper musicHelper;    private SQLiteDatabase db;    public static final Uri MUSIC_LIKE_URI = Uri.parse("content://" + AUTOHORITY + "/" + MusicHelper.TABLE_LIKE_MUSIC);    public static final Uri MUSIC_RECENT_URI = Uri.parse("content://" + AUTOHORITY + "/" + MusicHelper.TABLE_RECENT_MUSIC);    public static final Uri MUSIC_SONG_SHEET_URI = Uri.parse("content://" + AUTOHORITY + "/" + MusicHelper.TABLE_SONG_SHEET);    public static final Uri MUSIC_SONG_SHEET_DETAIL_URI = Uri.parse("content://" + AUTOHORITY + "/" + MusicHelper.TABLE_SONG_SHEET_DETAIL);    public static final Uri MUSIC_PLAYING_LIST_URI = Uri.parse("content://" + AUTOHORITY + "/" + MusicHelper.TABLE_MUSIC_PLAYING_LIST);    static {        matcher = new UriMatcher(UriMatcher.NO_MATCH);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_LIKE_MUSIC, 1);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_RECENT_MUSIC, 2);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_SONG_SHEET, 3);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_SONG_SHEET_DETAIL, 4);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_SONG_SHEET_DETAIL + "/#", 5);        matcher.addURI(AUTOHORITY, MusicHelper.TABLE_MUSIC_PLAYING_LIST, 6);    }    @Override    public boolean onCreate() {        context = getContext();        musicHelper = new MusicHelper(context);        db = musicHelper.getWritableDatabase();        return true;    }    @Nullable    @Override    public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) {        switch (matcher.match(uri)) {            case 1:            case 2:                return db.query(getType(uri), projection, selection, selectionArgs, null, null, MediaStore.Audio.AudioColumns.DATE_MODIFIED + " DESC");            case 3:                return db.query(getType(uri), projection, selection, selectionArgs, null, null, MusicHelper.SongSheetColumn.SONG_SHEET_UPDATE_TIME + " DESC");            case 5:                return db.query(getType(uri), projection, MusicHelper.SongSheetColumn.SONG_SHEET_ID + "=?",                        new String[]{ContentUris.parseId(uri) + ""}, null, null,                        MediaStore.Audio.AudioColumns.DATE_MODIFIED);            default:                break;        }        return db.query(getType(uri), projection, selection, selectionArgs, null, null, null);    }    @Nullable    @Override    public String getType(@NonNull Uri uri) {        String tableName = null;        switch (matcher.match(uri)) {            case 1:                tableName = MusicHelper.TABLE_LIKE_MUSIC;                break;            case 2:                tableName = MusicHelper.TABLE_RECENT_MUSIC;                break;            case 3:                tableName = MusicHelper.TABLE_SONG_SHEET;                break;            case 4:            case 5:                tableName = MusicHelper.TABLE_SONG_SHEET_DETAIL;                break;            case 6:                tableName = MusicHelper.TABLE_MUSIC_PLAYING_LIST;                break;            default:                break;        }        return tableName;    }    @Nullable    @Override    public Uri insert(@NonNull Uri uri, @Nullable ContentValues values) {        String table = getType(uri);        String displayName = values.getAsString(MediaStore.Audio.AudioColumns.DISPLAY_NAME);        switch (matcher.match(uri)) {            case 1:                if (query(uri, null, MediaStore.Audio.AudioColumns.DISPLAY_NAME + "=?", new String[]{displayName}, null).getCount() == 0) {                    break;                } else {                    delete(uri, MediaStore.Audio.AudioColumns.DISPLAY_NAME + "=?", new String[]{displayName});                    return uri;                }            case 2:                if (!TextUtils.isEmpty(displayName)) {                    db.delete(table, MediaStore.Audio.AudioColumns.DISPLAY_NAME + "=?", new String[]{displayName});                }                break;        }        db.insert(table, null, values);        return uri;    }    @Override    public int delete(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs) {        return db.delete(getType(uri), selection, selectionArgs);    }    @Override    public int update(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs) {        return db.update(getType(uri), values, selection, selectionArgs);    }}